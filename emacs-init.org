#+TITLE: Emacs Init
#+AUTHOR: Jonathan Lai

* Emacs Init as an Org file

** My Emacs setup
Lets make this organized and documented org-mode style

** init-basics
Here lets do the preliminary setup and put in some good defaults for emacs, including setting some system wide variables.

#+BEGIN_SRC emacs-lisp

(add-to-list 'load-path "~/.emacs.d/el-get/el-get")

(unless (require 'el-get nil 'noerror)
  (with-current-buffer
      (url-retrieve-synchronously
       "https://raw.githubusercontent.com/dimitri/el-get/master/el-get-install.el")
    (goto-char (point-max))
    (eval-print-last-sexp)))

(add-to-list 'el-get-recipe-path "~/.emacs.d/el-get-user/recipes")
(el-get 'sync)

;; https://stackoverflow.com/questions/23165158/how-do-i-install-melpa-packages-via-el-get
(require 'package)
(setq package-archives nil)
(setq package-archives '(("melpa" . "https://melpa.org/packages/")
                         ("gnu" . "http://elpa.gnu.org/packages/")))
(eval-when-compile (package-initialize))
(require 'el-get-elpa)
(unless (file-directory-p el-get-recipe-path-elpa)
  (el-get-elpa-build-local-recipes))

(el-get-bundle use-package)
(el-get-bundle egb-use-package)
(use-package egb-use-package)

(let ((default-directory "~/.emacs.d/custom/"))
  (normal-top-level-add-to-load-path '("."))
  (normal-top-level-add-subdirs-to-load-path))

(require 'dired-x)
(require 'cross-platform-copy-paste)

;; http://stackoverflow.com/questions/1480572/how-to-have-emacs-auto-refresh-all-buffers-when-files-have-changed-on-disk
(global-auto-revert-mode t)

(defcustom dotemacs-cache-directory (concat user-emacs-directory ".cache/")
  "The storage location for various persistent files.")

;; Backup Files location
;; https://github.com/bling/dotemacs/blob/master/config/init-core.el
(setq backup-directory-alist
  `((".*" . ,(concat dotemacs-cache-directory "backups")))
  auto-save-file-name-transforms
  `((".*" ,(concat dotemacs-cache-directory "backups") t))
  auto-save-list-file-prefix
  (concat dotemacs-cache-directory "auto-save-list/saves-"))

(setq custom-file (concat user-emacs-directory "custom/custom.el"))

;;(use-package esup)

(egb-use-package f
  :config
  (progn
    (unless (f-exists? dotemacs-cache-directory)
      (f-mkdir dotemacs-cache-directory))
    ;;(unless (f-exists? custom-file)
    ;;  (f-touch custom-file))
    ))

;; https://github.com/kiwanami/emacs-deferred
(egb-use-package deferred)

;; SPU - Emacs Silent Package Upgrader
;;(use-package spu
;;  :config
;;  (progn
;;    (setq spu-log-path (concat dotemacs-cache-directory "spu_log/"))))

(egb-use-package undo-tree
  :config
  (progn
    (global-undo-tree-mode t)))

;; Dont display logo at startup
(setq inhibit-startup-message t)

;; How do I change the scratch message in Emacs?
;; http://stackoverflow.com/a/1498292/2741455
(setq initial-scratch-message ";; This is the Emacs Scratch Buffer")

(defalias 'yes-or-no-p 'y-or-n-p)

;; Don't automatically add newline to end of file
(setq mode-require-final-newline nil)

(desktop-save-mode t)
(setq desktop-auto-save-timeout 1)
(setq desktop-path '("~/.emacs.d/.cache/"))
;;(setq desktop-path dotemacs-cache-directory)
(add-to-list 'desktop-modes-not-to-save 'dashboard-mode)
(add-to-list 'desktop-modes-not-to-save 'dired-mode)
(add-to-list 'desktop-modes-not-to-save 'neotree-mode)

;; https://bmag.github.io/2015/12/26/desktop.html
;; https://www.emacswiki.org/emacs?action=browse;oldid=DeskTop;id=Desktop
(setq bookmark-default-file  (concat dotemacs-cache-directory "bookmarks"))
(setq recentf-save-file (concat dotemacs-cache-directory "recentf"))
(if (not (f-exists? recentf-save-file))
  (progn
    (f-touch recentf-save-file)
    (use-package s) ;; this should already be installed -- f.el has this as a dependency
    (setq spacer-readme (s-concat (f-full user-emacs-directory) "README.md" )) ;; => /home/path/to/file
    (setq spacer-recentf (s-concat "(setq recentf-list '(\"" spacer-readme "\")) (setq recentf-filter-changer-current 'nil)"))
    (f-write spacer-recentf 'utf-8 recentf-save-file)))
(setq recentf-max-menu-items 10)
(setq recentf-auto-cleanup 'never)
(recentf-mode 1)

(setq-default tab-width 2)
(setq-default indent-tabs-mode nil) ;; seems to affect autocomplete modes

(setq visible-bell 1)
(menu-bar-mode -1)

;; recentf hook for when a file is not opened, but just a scratch buffer, then load recentf
;; (defun recentf-open-files-hook ()
;;   ;;(if (not (f-this-file))
;;   ;;  (recentf-open-files))
;;   (if (eq (buffer-file-name) nil)
;;     (recentf-open-files)))

;; (add-hook 'emacs-startup-hook 'recentf-open-files-hook)

;; Closing all other buffers in Emacs
;; http://stackoverflow.com/a/3417473/2741455
(defun kill-other-buffers ()
  "Kill all other buffers."
  ;; http://emacs.stackexchange.com/questions/14509/kill-process-buffer-without-confirmation
  ;; not used yet, but may be useful later
  (setq kill-buffer-query-functions (delq 'process-kill-buffer-query-function kill-buffer-query-functions))
  (interactive)
  ;; http://stackoverflow.com/questions/3417438/closing-all-other-buffers-in-emacs
  (mapc 'kill-buffer
    (delq (current-buffer)
      (remove-if-not 'buffer-file-name (buffer-list))))
  ;; http://emacs.stackexchange.com/questions/202/close-all-dired-buffers
  (mapc (lambda (buffer)
    (when (eq 'dired-mode (buffer-local-value 'major-mode buffer))
      (kill-buffer buffer)))
        (buffer-list))
  (custom/kill-buffers "^\\*magit") ;; kill magit buffers
  (custom/kill-buffers "^\\*grep") ;; kill projectile grep
  (custom/kill-buffers "^\\*pt") ;; kill projectile pt
)

;; https://github.com/magit/magit/issues/2124
(defun custom/kill-buffers (regexp)
  "Kill buffers matching REGEXP without asking for confirmation."
  (interactive "sKill buffers matching this regular expression: ")
  (cl-letf (((symbol-function 'kill-buffer-ask)
    (lambda (buffer) (kill-buffer buffer))))
    (kill-matching-buffers regexp)))

;; http://stackoverflow.com/questions/5052088/what-is-custom-set-variables-and-faces-in-my-emacs
;; http://emacsblog.org/2008/12/06/quick-tip-detaching-the-custom-file/
(setq custom-file "~/.emacs.d/custom/custom.el")
(load custom-file 'noerror)

(setq tramp-default-method "ssh")
;; https://github.com/syl20bnr/spacemacs/issues/192
;; find-tag-noselect' got redefined...noise
(setq ad-redefinition-action 'accept)

(egb-use-package restart-emacs)

#+END_SRC

** init-aesthetics
Lets make emacs look and behave better.

#+BEGIN_SRC emacs-lisp
(line-number-mode t)
(column-number-mode t)
(global-linum-mode t)

(egb-use-package smartparens
  :config
  (progn
    (require 'smartparens-config)
    (smartparens-global-mode 1)))

;; http://stackoverflow.com/questions/34531831/highlighting-trailing-whitespace-in-emacs-without-changing-character
(setq-default show-trailing-whitespace t)
(egb-use-package whitespace
  :config
  (progn
    (setq whitespace-style (quote (spaces tabs newline space-mark tab-mark newline-mark)))
    (setq whitespace-display-mappings
      '((space-mark 32 [183] [46])
        (tab-mark 9 [9655 9] [92 9])))))

(egb-use-package spaceline
  :config
  (progn
    (require 'spaceline-config)
    (spaceline-spacemacs-theme)))

;;(egb-use-package ethan-wspace)

;;(egb-use-package apropospriate-theme)
;;(use-package apropospriate-theme
;;  :init
;;  (progn
;;    (load-theme 'apropospriate-dark t)))

;;(egb-use-package spacemacs-theme
;;  :disabled
;;  :init
;;  (progn
;;    (load-theme 'spacemacs-dark t)))

(egb-use-package atom-dark-theme
  :disabled)

(egb-use-package zenburn-theme
  :disabled
  :init
  (progn
    (load-theme 'zenburn t)))

(egb-use-package seoul256-theme
  :init
  (progn
    (setq seoul256-background 235)
    (load-theme 'seoul256 t)))

(egb-use-package ample-theme
  :disabled
  :init
  (progn
    (load-theme 'ample t t)
    (load-theme 'ample-flat t t)
    (load-theme 'ample-light t t)
    (enable-theme 'ample-flat)))

(egb-use-package monokai-theme
  :disabled
  :init
  (progn
    (load-theme 'monokai t)))

#+END_SRC

** init-navigation
Gotta navigate around emacs more efficiently, and this is how.

#+BEGIN_SRC emacs-lisp
(use-package general)
(general-define-key
  :states '(normal motion emacs)
  :prefix ","

  ;;  Avoiding CTRL
  "w" (general-simulate-keys "C-w")
  "x" (general-simulate-keys "C-x")
  "c" (general-simulate-keys "C-c")
  "h" (general-simulate-keys "C-h")

  ;; The Rest

  "a" 'ace-jump-mode
  "b" 'ivy-switch-buffer
  "e" 'eval-region
  "f" 'my-search-util
  "j" 'prettier
  "l" 'linum-relative-toggle
  "k"  'kill-other-buffers
  "nf" 'neotree-find
  "nt" 'neotree-toggle
  "p" 'projectile-find-file
  "r" 'counsel-recentf
  "/" 'evilnc-comment-or-uncomment-lines
  "<down>" 'drag-stuff-down
  "<up>" 'drag-stuff-up)
;;(use-package general
;;  :config
;;  (setq general-default-prefix "<SPC>")
;;  (general-evil-setup)
;;  (general-nmap
;;    "e" 'eval-region
;;    "f" 'my-search-util
;;    "k" 'kill-other-buffers
;;  ))

(egb-use-package smex)

(egb-use-package swiper
  :features ivy
  :pkgname ivy
  ;;:ensure smex ;; http://emacs.stackexchange.com/questions/17710/use-package-with-config-to-set-variables
  :config
  (progn
    (setq smex-save-file (concat dotemacs-cache-directory "smex-items")) ;; retain smex for the sort by most recent / frequently used commands
    (ivy-mode 1)
    ;; https://github.com/abo-abo/swiper/issues/164
    (define-key
      ivy-switch-buffer-map
      (kbd "C-k")
      (lambda ()
        (interactive)
        (ivy-set-action 'kill-buffer)
        (ivy-done)))
    (global-set-key (kbd "M-x") 'counsel-M-x) ;; when in Emacs keybindings
    (setq ivy-height 14) ;; number of result lines to display
    ;; (setq ivy-initial-inputs-alist nil) ;; no regexp by default
    (setq ivy-re-builders-alist
      '((t . ivy--regex-fuzzy)))))

;; https://manuel-uberti.github.io/emacs/2016/09/17/validate/
;;(use-package validate)
;;
;; https://github.com/krobertson/emacs.d/blob/master/packages.el
(egb-use-package projectile
  :config
  (progn
    (projectile-global-mode 1)
    ;;https://github.com/lunaryorn/.emacs.d/blob/master/init.el
    ;;(validate-setq projectile-completion-system 'ivy
    ;;  projectile-find-dir-includes-top-level t)
    (setq projectile-completion-system 'ivy))
  :init
  (progn
    (setq projectile-known-projects-file (concat dotemacs-cache-directory "projectile-bookmarks.eld"))
    (setq projectile-require-project-root nil)))

(egb-use-package counsel-projectile
  :defer t
  :config
  (progn
    (counsel-projectile-on)))

(egb-use-package emacs-neotree
  :pkgname neotree
  :config
  (progn
    (setq-default neo-show-hidden-files t)
    ;; from https://github.com/kaushalmodi/.emacs.d/blob/master/setup-files/setup-neotree.el
    (setq neo-theme 'nerd) ; 'classic, 'nerd, 'ascii, 'arrow
    (setq neo-vc-integration '(face char))
    ;; Patch to fix vc integration
    (defun neo-vc-for-node (node)
      (let* ((backend (vc-backend node))
             (vc-state (when backend (vc-state node backend))))
        ;; (message "%s %s %s" node backend vc-state)
        (cons (cdr (assoc vc-state neo-vc-state-char-alist))
              (cl-case vc-state
                (up-to-date       neo-vc-up-to-date-face)
                (edited           neo-vc-edited-face)
                (needs-update     neo-vc-needs-update-face)
                (needs-merge      neo-vc-needs-merge-face)
                (unlocked-changes neo-vc-unlocked-changes-face)
                (added            neo-vc-added-face)
                (removed          neo-vc-removed-face)
                (conflict         neo-vc-conflict-face)
                (missing          neo-vc-missing-face)
                (ignored          neo-vc-ignored-face)
                (unregistered     neo-vc-unregistered-face)
                (user             neo-vc-user-face)
                (t                neo-vc-default-face)))))
    ;; from https://github.com/kaushalmodi/.emacs.d/blob/master/setup-files/setup-neotree.el

    ;; from https://github.com/andrewmcveigh/emacs.d
    ;; get keybindings to work better in neotree with evil
    (defun neotree-copy-file ()
      (interactive)
      (let* ((current-path (neo-buffer--get-filename-current-line))
             (msg (format "Copy [%s] to: "
                          (neo-path--file-short-name current-path)))
             (to-path (read-file-name msg (file-name-directory current-path))))
        (dired-copy-file current-path to-path t))
      (neo-buffer--refresh t))
    (define-minor-mode neotree-evil
      "Use NERDTree bindings on neotree."
      :lighter " NT"
      :keymap (progn
                (evil-make-overriding-map neotree-mode-map 'normal t)
                (evil-define-key 'normal neotree-mode-map
                  "C" 'neotree-change-root
                  "U" 'neotree-select-up-node
                  "r" 'neotree-refresh
                  "o" 'neotree-enter
                  (kbd "<return>") 'neotree-enter
                  "i" 'neotree-enter-horizontal-split
                  "s" 'neotree-enter-vertical-split
                  "n" 'evil-search-next
                  "N" 'evil-search-previous
                  "ma" 'neotree-create-node
                  "mc" 'neotree-copy-file
                  "md" 'neotree-delete-node
                  "mm" 'neotree-rename-node
                  "gg" 'evil-goto-first-line)
                neotree-mode-map))))

(egb-use-package dashboard
  :config
  (progn
    (setq show-trailing-whitespace nil)
    (dashboard-setup-startup-hook)
    (setq dashboard-items '((recents  . 15)
                            (bookmarks  . 5)
                            (projects . 5)))))

(egb-use-package ace-jump-mode
  :config
  (progn
    (define-key global-map (kbd "C-c SPC") 'ace-jump-mode)))

(require 'saveplace)
(setq-default save-place t)
(setq save-place-forget-unreadable-files nil)
;; Try to make emacsclient play nice with saveplace
;; http://www.emacswiki.org/emacs/EmacsClient#toc35
(setq server-visit-hook (quote (save-place-find-file-hook)))
;; rename this save file....
(setq save-place-file "~/.emacs.d/.cache/saved-places")
#+END_SRC

** init-evil
Lets add the awesome vim/modal editing keybindings. So much more fluid to edit with than emacs own.

#+BEGIN_SRC emacs-lisp
(egb-use-package goto-chg)
;; evil mode setup ;;
(setq evil-want-C-w-in-emacs-state t)
(setq evil-default-cursor t)
(egb-use-package evil
  :config
  (progn
    (evil-mode 1)
    ;; https://stackoverflow.com/questions/14302171/ctrl-u-in-emacs-when-using-evil-key-bindings
    (define-key evil-normal-state-map (kbd "C-u") 'evil-scroll-up)
    (define-key evil-visual-state-map (kbd "C-u") 'evil-scroll-up)
    (define-key evil-normal-state-map ";" 'evil-ex)
    (define-key evil-normal-state-map ":" 'counsel-M-x)

    ;; for use in counsel-M-x / smex
    (defalias 'w 'evil-write)
    (defalias 'wq 'evil-save-and-close)
    (defalias 'wq! 'evil-save-and-close)
    (defalias 'q 'evil-quit)
    (defalias 'q! 'evil-quit)
    (defalias 'gst 'magit-status)
    (defalias 'st 'magit-status)

    ;;(evil-set-initial-state 'magit-status-mode 'emacs)
    ;;(evil-set-initial-state 'magit-log-edit-mode 'emacs)
    (evil-set-initial-state 'dashboard-mode 'emacs)

    (define-key evil-normal-state-map (kbd "C-<down>") 'drag-stuff-down)
    (define-key evil-normal-state-map (kbd "C-<up>") 'drag-stuff-up)

    (define-key evil-motion-state-map "j" 'evil-next-visual-line)
    (define-key evil-motion-state-map "k" 'evil-previous-visual-line)

    ;; https://stackoverflow.com/questions/20882935/how-to-move-between-visual-lines-and-move-past-newline-in-evil-mode
    ;; Make horizontal movement cross lines
    (setq-default evil-cross-lines t)

    (define-key evil-normal-state-map (kbd "C-w ]") 'evil-window-rotate-downwards)
    (define-key evil-normal-state-map (kbd "C-w [") 'evil-window-rotate-upwards)

    (define-key evil-normal-state-map (kbd "C-h")   'evil-window-left)
    (define-key evil-normal-state-map (kbd "C-j")   'evil-window-down)
    (define-key evil-normal-state-map (kbd "C-k")   'evil-window-up)
    (define-key evil-normal-state-map (kbd "C-l")   'evil-window-right)

    (evil-ex-define-cmd "Q"  'evil-quit)
    (evil-ex-define-cmd "Qa" 'evil-quit-all)
    (evil-ex-define-cmd "QA" 'evil-quit-all)

    ;; setup extra keybindings ;;
    ;; Bind DEL and = keys to scrolling up and down
    ;; https://stackoverflow.com/questions/8483182/evil-mode-best-practice
    (define-key evil-normal-state-map (kbd "DEL") (lambda ()
      (interactive)
      (previous-line 10)
      (evil-scroll-line-up 10)))

    (define-key evil-normal-state-map (kbd "=") (lambda ()
      (interactive)
      (next-line 10)
      (evil-scroll-line-down 10)))
  ))

(egb-use-package evil-escape
  :config
  (progn
    (evil-escape-mode)
    (setq-default evil-escape-key-sequence "kj")))

(egb-use-package evil-matchit
  :config
  (progn
    (global-evil-matchit-mode 1)))

(egb-use-package evil-surround
  :config
  (progn
    (global-evil-surround-mode 1)))

(egb-use-package evil-visualstar
  :config
  (progn
    (global-evil-visualstar-mode)))

(egb-use-package evil-numbers
  :config
  (progn
    (define-key evil-normal-state-map (kbd "C-<right>") 'evil-numbers/inc-at-pt)
    (define-key evil-normal-state-map (kbd "C-<left>") 'evil-numbers/dec-at-pt)))
#+END_SRC

** init-coding
Here we're going to make emacs a great coding environment.

#+BEGIN_SRC emacs-lisp
;; enable seeing of git diffs
;; got git-gutter working properly with use-package
;; https://github.com/hlissner/emacs.d/blob/master/init/init-git.el
(egb-use-package git-gutter
  :diminish git-gutter-mode
  :config
  (progn
    (global-git-gutter-mode 1)))

(egb-use-package git-timemachine)

(egb-use-package magit
  :defer t
  :config
  (progn
    ;; http://whattheemacsd.com/setup-magit.el-01.html
    ;; http://www.lunaryorn.com/posts/fullscreen-magit-status.html
    (magit-auto-revert-mode 0) ;; magit auto revert mode seemed to take some time on startup
    (egb-use-package evil-magit
      ;; http://cachestocaches.com/2016/12/vim-within-emacs-anecdotal-guide/
      ;; https://github.com/gjstein/emacs.d/blob/cb126260d30246dc832d6e456b06676f517b35b0/config/init-40-coding-gen.el#L90-L111
      :config
      ;; Default commit editor opening in insert mode
      (add-hook 'with-editor-mode-hook 'evil-insert-state)
      ;; (evil-define-key 'normal with-editor-mode-map
      ;;   (kbd "RET") 'with-editor-finish
      ;;   [escape] 'with-editor-cancel)
      ;; (evil-define-key 'normal git-rebase-mode-map
      ;;   "l" 'git-rebase-show-commit)
      )
    (defadvice magit-status (around magit-fullscreen activate)
      (window-configuration-to-register :magit-fullscreen)
      ad-do-it
      (delete-other-windows))
    (defun magit-quit-session ()
      "Restores the previous window configuration and kills the magit buffer"
      (interactive)
      (kill-buffer)
      (jump-to-register :magit-fullscreen))))

(egb-use-package evil-nerd-commenter
  :commands (evilnc-comment-or-uncomment-lines)
  :config
  (progn
    (evilnc-default-hotkeys)))

(egb-use-package editorconfig
  :config
  (progn
    (editorconfig-mode 1)))

(egb-use-package php-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '("\\.php?\\'" . php-mode))
    ;; for drupal file editing
    (add-to-list 'auto-mode-alist '("\\.inc?\\'" . php-mode))
    (add-to-list 'auto-mode-alist '("\\.module?\\'" . php-mode))))

(egb-use-package web-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '("\\.jsx?\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.gsp?\\'" . web-mode))))

;; https://github.com/yasuyk/web-beautify
;; js-beautify installed by typing: npm -g install js-beautify
;; beautify js AND html AND css
(when (executable-find "js-beautify")
  (egb-use-package web-beautify))

(egb-use-package js2-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '("\\.js?\\'" . js2-mode))))

;;http://stackoverflow.com/questions/28017629/how-do-i-set-indent-to-2-spaces-in-js2-mode
(add-hook 'js2-mode-hook
  (lambda () (setq js2-basic-offset 2)))

;; prettier installed by typing: npm -g install prettier
(when (executable-find "prettier")
  (egb-use-package prettier-js)
  (setq prettier-js-width-mode nil)
  (setq prettier-js-args '("--single-quote" "--bracket-spacing"))
  (add-hook 'js2-mode-hook 'prettier-js-mode)
  (eval-after-load 'js2-mode
    '(define-key js2-mode-map (kbd "C-c j") 'prettier-js)))

(egb-use-package emacs-pug-mode
  :pkgname pug-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '("\\.jade?\\'" . pug-mode))
    (add-to-list 'auto-mode-alist '("\\.pug?\\'" . pug-mode))))

;; https://github.com/jcf/emacs.d/blob/master/init-languages.org
(require 'css-mode)
(setq css-indent-offset 2)

(egb-use-package rainbow-mode
  :init
  (dolist (hook '(css-mode-hook html-mode-hook))
    (add-hook hook 'rainbow-mode)))

(egb-use-package groovy-mode
  :config
  (progn
    (autoload 'groovy-mode "groovy-mode" "Major mode for editing Groovy code." t)
    (add-to-list 'auto-mode-alist '("\.groovy$" . groovy-mode))
    (add-to-list 'auto-mode-alist '("\.gradle$" . groovy-mode))
    (add-to-list 'interpreter-mode-alist '("groovy" . groovy-mode))))

(egb-use-package go-mode
  :config
  (progn
    (autoload 'go-mode "go-mode" "Major mode for editing Go code." t)
    (add-to-list 'auto-mode-alist '("\\.go?\\'" . go-mode))))

(egb-use-package lua-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '("\\.lua?\\'" . lua-mode))))

(egb-use-package vimrc-mode
  :config
  (progn
    (add-to-list 'auto-mode-alist '(".vim\\(rc\\)?$" . vimrc-mode))))

(egb-use-package drag-stuff
  :config
  (progn
    (drag-stuff-global-mode t)))

;; http://stackoverflow.com/a/15310340/2741455
;; How to set defcustom variable
(egb-use-package linum-relative
  :config
  (progn
    (setq linum-relative-format "%3s ")
    (setq linum-relative-current-symbol "")))

(cond ((executable-find "pt")
        (progn
          (egb-use-package pt) ;; https://github.com/bling/pt.el
          (defalias 'my-search-util 'projectile-pt)))  ;; seems pretty fast (faster than ag? maybe...dunno), but it's written in Go!
      ((executable-find "ag")
        (progn
          (egb-use-package ag) ;; https://github.com/Wilfred/ag.el
          (defalias 'my-search-util 'projectile-ag)))  ;; on the website, it said faster than ack
      ((executable-find "grep")
        (progn
          (defalias 'my-search-util 'projectile-grep))))

;; https://www.reddit.com/r/emacs/comments/6ddr7p/snippet_search_cheatsh_using_ivy/
(defun ejmr-search-cheat-sh ()
  "Search `http://cheat.sh/' for help on commands and code."
  (interactive)
  (ivy-read "Command or Topic: "
      (process-lines "curl" "--silent" "http://cheat.sh/:list?T&q")
      :require-match t
      :sort t
      :history 'ejmr-search-cheat-sh
      :action (lambda (input)
        (browse-url (concat "http://cheat.sh/" input "?T&q")))
      :caller 'ejmr-search-cheat-sh))

#+END_SRC

** init-last-minute-touches
Here are some last minute touches. Run silent package upgrader and elpa-mirror towards the end of this init file, because by then use-package will have installed all packages of interest into the ~/.emacs.d/elpa directory. After all packages are there, then is the proper time to backup them.

#+BEGIN_SRC emacs-lisp

#+END_SRC
